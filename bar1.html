<!-- HTML Document Structure -->
<!DOCTYPE html>
<html>
  <head>
    <!-- Document metadata -->
    <meta charset="UTF-8" />
    <title>Startup Valuations</title>

    <!-- D3.js library for data visualization -->
    <script src="https://d3js.org/d3.v6.min.js"></script>

    <!-- Styling -->
    <style>
      /* Global styles */
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f2f2f2;
      }

      /* Header styles */
      header {
        background-color: #333;
        color: #fff;
        padding: 20px;
        text-align: center;
      }
      /* Navbar styles */
      nav {
        background-color: #444;
        padding: 10px 0;
        text-align: center;
      }
      nav a {
        color: #fff;
        text-decoration: none;
        margin: 0 20px;
      }
      nav a:hover {
        text-decoration: underline;
      }
      .bar {
        fill: skyblue;
      }
      .bar:hover {
        fill: brown;
      }
      .bar.black {
        fill: black;
      }
      .axis {
        font-size: 12px;
      }
      .axis path,
      .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
      }
      .x-axis path {
        display: none;
      }
      .tooltip {
        position: absolute;
        background-color: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 8px;
        border-radius: 4px;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header>
      <h1>Startup Surge: Visualizing The Entrepreneurial Landscape</h1>
      <h3>
        Team members: Aditya Garg(2022101083), Aniket Bansal(2022101050) and
        Kunal Angadi(2022111005)
      </h3>
    </header>
      <!-- Navigation -->
    <nav>
      <a href="index.html">Home Page</a>
      <a href="bar1.html">Visualization 1</a>
    </nav>
      <!-- Main content -->
    <h1 style="margin-left: 20px">Valuation ($B) of Startup Companies</h1>
    <label for="industry-select" style="margin-left: 50px;">Select Industry:</label>
    <select id="industry-select"></select>
    <label for="color-select" style="margin-left: 50px;">Select Color:</label>
    <select id="color-select">
      <option value="skyblue">Sky Blue</option>
      <option value="black">Black</option>
    </select>
    <div id="chart"></div>

    <script>
      // Load data from the csv
      d3.csv("startups2.csv").then(function (data) {
        // Process data by converting 'Valuation ($B)' column to numeric after removing '$' and 'B'
        data.forEach(function (d) {
          d["Valuation ($B)"] = parseFloat(
            d["Valuation ($B)"].replace(/[$B,]/g, "")
          );
        });

        // Create dropdown menu for user to select the industry
        const industrySelect = d3.select("#industry-select");
        const industries = [...new Set(data.map((d) => d.Industry))];
        industrySelect
          .selectAll("option")
          .data(industries)
          .enter()
          .append("option")
          .attr("value", function (d) {
            return d;
          })
          .text(function (d) {
            return d;
          });

        // Initial render the graph for the first industry by default
        renderChart(data, industries[0]);

        // Update chart whenever user selects a different industry
        industrySelect.on("change", function () {
          const selectedIndustry = this.value;
          renderChart(data, selectedIndustry);
          selectedColor = document.getElementById("color-select").value;
          updateBarColor(selectedColor);
        });

        // Add event listener for color for whenever user selects a different color
        const colorSelect = document.getElementById("color-select");
        colorSelect.addEventListener("change", function () {
          const selectedColor = this.value; //
          updateBarColor(selectedColor);
        });
      });

      // Function to render the bar chart
      function renderChart(data, industry) {
        const filteredData = data.filter(function (d) {
          return d.Industry === industry; // Filter data by industry
        });
        selectedColor = document.getElementById("color-select").value;
        updateBarColor(selectedColor);

        // Sort data by valuation in ascending order
        filteredData.sort(function (a, b) {
          return a["Valuation ($B)"] - b["Valuation ($B)"];
        });
        // Set up the dimensions and margins
        const width = 1700;
        const height = 600;
        const margin = { top: 50, right: 20, bottom: 150, left: 80 };

        d3.select("#chart").selectAll("svg").remove(); // Clear previous chart
        // Create SVG element
        const svg = d3
          .select("#chart")
          .append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr("transform", `translate(${margin.left},${margin.top})`);

        // X-axis scale
        const x = d3.scaleBand().range([0, width]).padding(0.2);

        // Y-axis scale
        const y = d3.scaleLinear().range([height, 0]);
        // Set the domain of the scales
        x.domain(
          filteredData.map(function (d) {
            return d.Company;
          })
        );
        y.domain([
          0,
          d3.max(filteredData, function (d) {
            return d["Valuation ($B)"];
          }),
        ]);
        // define the x-axis
        svg
          .append("g")
          .attr("class", "x-axis")
          .attr("transform", `translate(0,${height})`)
          .call(d3.axisBottom(x))
          .selectAll("text")
          .style("text-anchor", "end")
          .attr("dx", "-.8em")
          .attr("dy", ".15em")
          .attr("transform", "rotate(-65)");

        // define the y-axis
        svg.append("g").attr("class", "y-axis").call(d3.axisLeft(y));

        // Defining each bar's attributes
        const bars = svg
          .selectAll(".bar")//selecting bar
          .data(filteredData)//filling data
          .enter()
          .append("rect")
          .attr("class", "bar")
          .attr("x", function (d) {
            return x(d.Company);
          })
          .attr("width", x.bandwidth())
          .attr("y", function (d) {
            return y(d["Valuation ($B)"]);
          })
          .attr("height", function (d) {
            return height - y(d["Valuation ($B)"]);
          });

        // Defining the chart title
        svg
          .append("text")
          .attr("x", width / 2)
          .attr("y", 0 - margin.top / 2)
          .attr("text-anchor", "middle")
          .style("font-size", "16px")
          .style("font-weight", "bold")
          .text(`Valuation ($B) of Companies in ${industry}`);

        // X-axis labels
        svg
          .append("text")
          .attr("x", width / 2)
          .attr("y", height + margin.bottom - 10)
          .attr("text-anchor", "middle")
          .style("font-size", "12px")
          .text("Company");

        // Y-axis labels
        svg
          .append("text")
          .attr("x", 0 - height / 2)
          .attr("y", 0 - margin.left + 20)
          .attr("text-anchor", "middle")
          .attr("transform", "rotate(-90)")
          .style("font-size", "12px")
          .text("Valuation ($B)");

        // Creating the tooltip element to display on hover
        const tooltip = d3
          .select("body")
          .append("div")
          .attr("class", "tooltip")
          .style("opacity", 0);

        // Tooltip behavior
        bars
          .on("mouseover", function (event, d) {
            tooltip
              .html(
                `<p><strong>Investors:</strong> ${d["Select Investors"]}</p><p><strong>Date Joined:</strong> ${d["Date Joined"]}</p><p><strong>Valuation($B):</strong> ${d["Valuation ($B)"]}</p>`
              )
              .style("left", event.pageX + "px")
              .style("top", event.pageY - 28 + "px")
              .transition()
              .duration(200)
              .style("opacity", 0.9);
          })
          .on("mouseout", function () {
            tooltip.transition().duration(500).style("opacity", 0);
          });
      }
      // Function to update bar color
      function updateBarColor(color) {
        d3.selectAll(".bar").attr("class", "bar").classed(color, true);
      }
    </script>
  </body>
</html>
